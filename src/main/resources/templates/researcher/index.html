<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org">
<head>
    <title>MIB Enterprise </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" type="text/css" media="all" th:href="@{/css/styles.css}">
</head>

<body>

<div class="container black">
    <div class="documents-container">
        <div class="menu">
            <ul>
                <li name = "add">Новая технология</li>
                <li name = "logout">Выйти</li>
            </ul>
        </div>
        <div class="search-form">
            <form class="form search" th:object="${findFilds}" th:action="@{/researcherIndex}" method="post">
                <div class="label">
                    Название технологии:
                </div>
                <input th:field="*{name}" class="field" type="text" placeholder="Введите..." />
                <div class="inline-block">
                    <div class="header">
                        Раса изобретатель:
                    </div>
                    <select th:field="*{idRace}"  class="field">
                        <option value="0"> -- </option>
                        <option th:each="alienRace : ${alienRaces}"  th:value="${alienRace.raceId}"  th:utext="${alienRace.name}"/>
                    </select>
                </div>
                <div class="inline-block">
                    <div class="header">
                        Способ получения:
                    </div>
                    <select th:field="*{idSource}" class="field">
                        <option value="0"> -- </option>
                        <option th:each="sourceTechnology : ${sourcesTechnology}"  th:value="${sourceTechnology.sourceId}"  th:utext="${sourceTechnology.value}"/>
                    </select>
                </div>
                <div class="inline-block">
                    <div class="header">
                        Ключевые слова:
                    </div>
                    <input th:field="*{description}" type="text" class="field" />
                    <input type="submit" class="field" value="Поиск" />
                </div>
            </form>
        </div>
        <div class="content">
            <table border="1" width="100%">
                <tr>
                    <th>Название технологии</th>
                    <th>Раса изобретатель</th>
                    <th>Способ получения</th>
                    <th>Описание</th>
                    <th></th>
                </tr>
                <!-- FOR aliens PRINT -->
                <tr th:each="technology : ${technologies}">
                    <td th:utext="${technology.name}"></td>
                    <td th:utext="${technology.nameRace}"></td>
                    <td th:utext="${technology.valueSourse}"></td>
                    <td th:utext="${technology.description}"></td>
                    <td>
                        <button name = "edit" th:data1="${technology.name}" th:data2="${technology.use}" th:data3="${technology.description}" th:onmouseup="|getTechnology('${technology.technologyId}', this.getAttribute('data1'), this.getAttribute('data2'), ${technology.idRace}, ${technology.idSource}, this.getAttribute('data3'));|" class = "button-edit">Редактировать</button>
                        <button name = "delete" th:onmouseup="|getIdByButton(${technology.technologyId});|"  class = "button-edit" >Удалить</button>
                    </td>
                </tr>
                <!-- END FOR -->
            </table>
        </div>
    </div>

    <div id="add-modal" class="modal">
        <form class="modal-content form technology" method="POST" th:object="${addTechnology}" th:action="@{/addTechnology}">
            <table>
                <tr>
                    <td colspan="2" align="center">
                        <div class="header">Технология</div>
                    </td>
                </tr>
                <tr>
                    <td class="col-1">
                        <div class="label">Название технологии:</div>
                    </td>
                    <td class="col-2">
                        <input th:field="*{name}" class="field" type="text" placeholder="Введите..." />
                    </td>
                </tr>
                <tr>
                    <td class="col-1">
                        <div class="label">Назначение:</div>
                    </td>
                    <td class="col-2">
                        <input th:field="*{use}" class="field" type="text" placeholder="Введите..." />
                    </td>
                </tr>
                <tr>
                    <td class="col-1">
                        <div class="label">Раса изобритатель:</div>
                    </td>
                    <td class="col-2">
                        <select th:field="*{idRace}"  class="field">
                            <option value="0"> -- </option>
                            <option th:each="alienRace : ${alienRaces}"  th:value="${alienRace.raceId}"  th:utext="${alienRace.name}"/>
                        </select>
                    </td>
                </tr>
                </tr>
                <tr>
                    <td class="col-1">
                        <div class="label">Способ получения:</div>
                    </td>
                    <td class="col-2">
                        <select th:field="*{idSource}" class="field">
                            <option value="0"> -- </option>
                            <option th:each="sourceTechnology : ${sourcesTechnology}"  th:value="${sourceTechnology.sourceId}"  th:utext="${sourceTechnology.value}"/>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <div class="label">Описание:</div>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <textarea th:field="*{description}" class="textarea"></textarea>
                    </td>
                </tr>
                <tr>
                    <td align="left">
                        <input type="button" class="close" value="К документам">
                    </td>
                    <td align="right">
                        <input type="submit" value="Создать" />
                    </td>
                </tr>
            </table>
        </form>
    </div>


    <div id="edit-modal" class="modal">
        <form class="modal-content form technology" method="POST" th:object="${addTechnology}" th:action="@{/updateTechnology}">
            <table>
                <tr>
                    <td colspan="2" align="center">
                        <div class="header">Технология</div>
                    </td>
                    <td>
                        <input id="technologyId" th:field="*{technologyId}" class="field" type="hidden" placeholder="Введите..." />
                    </td>
                </tr>
                <tr>
                    <td class="col-1">
                        <div class="label">Название технологии:</div>
                    </td>
                    <td class="col-2">
                        <input id="technologyName" th:field="*{name}" class="field" type="text" placeholder="Введите..." />
                    </td>
                </tr>
                <tr>
                    <td class="col-1">
                        <div class="label">Назначение:</div>
                    </td>
                    <td class="col-2">
                        <input id="technologyUse" th:field="*{use}" class="field" type="text" placeholder="Введите..." />
                    </td>
                </tr>
                <tr>
                    <td class="col-1">
                        <div class="label">Раса изобритатель:</div>
                    </td>
                    <td class="col-2">
                        <select id="technologyIdRace" th:field="*{idRace}"  class="field">
                            <option value="0"> -- </option>
                            <option th:each="alienRace : ${alienRaces}"  th:value="${alienRace.raceId}"  th:utext="${alienRace.name}"/>
                        </select>
                    </td>
                </tr>
                </tr>
                <tr>
                    <td class="col-1">
                        <div class="label">Способ получения:</div>
                    </td>
                    <td class="col-2">
                        <select id="technologyIdSource" th:field="*{idSource}" class="field">
                            <option value="0"> -- </option>
                            <option th:each="sourceTechnology : ${sourcesTechnology}"  th:value="${sourceTechnology.sourceId}"  th:utext="${sourceTechnology.value}"/>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <div class="label">Описание:</div>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <textarea id="technologyDescription" th:field="*{description}" class="textarea"></textarea>
                    </td>
                </tr>
                <tr>
                    <td align="left">
                        <input type="button" class="close" value="К документам">
                    </td>
                    <td align="right">
                        <input type="submit" value="Сохранить" />
                    </td>
                </tr>
            </table>
        </form>
    </div>

    <div id="logout-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <form class="form" method="POST" action="/logout">
                <table width=100%>
                    <tr>
                        <td align="center" colspan="3">
                            <h4>Вы действительно хотите выйти?</h4>
                        </td>
                    </tr>
                    <tr>
                        <td width=50%><input class="w-100" type="submit" value="Ok" /></td>
                        <td width=50%><input class="w-100 close" type="button" value="Отмена" /></td>
                    </tr>
                </table>
            </form>
        </div>
    </div>

    <div id="delete-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <form class="form" method="POST" th:object="${addTechnology}" th:action="@{/deleteTechnology}">
                <table width=100%>
                    <tr>
                        <td align="center" colspan="3">
                            <h4>Вы действительно хотите удалить запись?</h4>
                        </td>
                    </tr>
                    <tr>
                        <td width=0%><input id="technologyIdDelete" th:field="*{technologyId}" class="field" type="hidden" placeholder="Введите..." /></td>
                        <td width=50%><input class="w-100" type="submit" value="Ок" /></td>
                        <td width=50%><input class="w-100 close" type="button" value="Отмена" /></td>
                    </tr>
                </table>
            </form>
        </div>
    </div>

    <script>
        function getIdByButton(id) {
            document.getElementById("technologyIdDelete").value = id;
        }

        function getTechnology(technologyId, name, use, idRace, idSource, description) {
            document.getElementById("technologyId").value = technologyId;
            document.getElementById("technologyName").value = name;
            document.getElementById("technologyUse").value = use;
            document.getElementById("technologyIdRace").value = idRace;
            document.getElementById("technologyIdSource").value = idSource;
            document.getElementById("technologyDescription").value = description;
        }

        function closeModal(modal) {
            modal.style.display = "none";
        }

        let modal_ids = ["edit-modal", "add-modal", "logout-modal", "delete-modal"];
        let modal_btn_names = ["edit", "add", "logout", "delete"];
        let modals = [];

        for (let id of modal_ids) {
            let modal = document.getElementById(id);
            modals.push(modal);
            let btns = modal.querySelectorAll(".close");
            for (let btn of btns) {
                btn.onclick = function () { closeModal(modal); }
            }
        }

        for (let id of modal_btn_names) {
            let btns = document.getElementsByName(id);
            for(let btn of btns) {
                btn.onclick = function () {
                    document.getElementById(id+"-modal").style.display = "block";
                }
            }
        }

        window.onclick = function (event) {
            for (let modal of modals) {
                if (event.target == modal) {
                    event.target.style.display = "none";
                }
            }
        }
    </script>

</body>
</html>